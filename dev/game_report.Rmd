---
title: "SeasonAtAGlance"
author: "KevinB"
date: "12/1/2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(mysportsfeedsR)
library(tidyverse)
library(glue)
library(lubridate)
library(formattable)
library(tidynbadata)


authenticate_v2_x(apikey = 'abd52306-deb4-4204-8605-e877fc')

# walk(list.files('R', pattern = '.R$', full.names = TRUE), function(x) {
#   message(glue('loading {basename(x)} . . .'))
#   source(x)
# })


team_id <- 83
team_name <- 'Knicks'

sched <- get_team_schedule()
game_ids <- sched %>% filter(status == 'complete') %>% pull(msf_game_id)
games <- game_ids %>% map(load_pbp_data, team = team_id)
all_games <- do.call('bind_rows', games)


game <- 47899
opponent_id <- all_games %>% filter(game_id == game) %>% 
  pull(opponent_id) %>% head(1)
opponent_name <- interpret_team(opponent_id)$name

score <- all_games %>% filter(game_id == 47899) %>% 
  summarize(Knicks = sum(score_points_this_team),
            Opponent = sum(score_points_opponent_team)) %>% 
  set_names(c('Knicks', opponent_name))



formattable(score,
            list(Knicks = formatter("span", 
                                    style =  ~ style(color = if_else(score$Knicks[1] > score[1, 2], "green", "red")))))



```



```{r plot_game}

p <- plot_game_score(all_games %>% filter(game_id == game))

p


```
## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{four_factors}
## ideas - plot of scores
# 4 factors - showing where is stands on team values all season (also compare to other teams)
# also 4 factors for opponents
# identify standout players
# show primary lineups and their stats
# show players and their stats with display for minutes played - also comare to their season values
# 
```



```{r pressure, echo=FALSE}

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
